# ApiFlowAgent 项目规格

> 接口自动化全流程 Agent，基于 Claude SDK

## 项目背景

构建一个 AI 驱动的 API 自动化测试工具，利用 Claude 的智能能力自动解析 API 文档、生成测试用例、推断接口依赖，并通过 Python 执行层完成测试执行和报告生成。

## 目标用户

- QA 工程师：快速生成 API 测试用例
- 后端开发：接口开发完成后自测
- DevOps：CI/CD 中集成 API 测试

## 核心价值

1. **降低门槛**：无需手写测试用例，AI 自动生成
2. **提高效率**：一键完成 解析→生成→执行→报告 全流程
3. **节省成本**：测试计划可复用，Token 消耗仅在生成阶段

---

## 功能列表

### 1. 文档解析模块

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| Swagger/OpenAPI 3.0 解析 | ✅ | | JSON/YAML 格式 |
| OpenAPI 2.0 解析 | | ✅ | 旧版 Swagger |
| Postman Collection 解析 | | ✅ | v2.1 格式 |
| API Blueprint 解析 | | ✅ | |
| GraphQL Schema 解析 | | ✅ | |

### 2. 用例生成模块

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| 正向用例生成 | ✅ | | 每接口 1 个 |
| 异常用例生成 | ✅ | | 每接口 1 个 |
| 边界值用例 | | ✅ | 参数边界测试 |
| 参数组合用例 | | ✅ | 正交实验法 |
| 业务场景用例 | | ✅ | 多接口串联 |
| 安全测试用例 | | ✅ | SQL注入、XSS等 |

### 3. 依赖推断模块

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| AI 推断 + 人工确认 | ✅ | | 交互式确认 |
| 全自动静默推断 | | ✅ | 无需确认 |
| 循环依赖检测 | | ✅ | |
| 并行执行优化 | | ✅ | 无依赖接口并发 |

### 4. 断言引擎

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| status_code 校验 | ✅ | | HTTP 状态码 |
| json_path exists | ✅ | | 字段存在性 |
| json_path equals | ✅ | | 字段值相等 |
| json_path contains | | ✅ | 字符串包含 |
| 类型校验 (is_number等) | | ✅ | |
| length 校验 | | ✅ | 数组/字符串长度 |
| regex 正则匹配 | | ✅ | |
| 数值比较 (gt/lt) | | ✅ | |
| header 响应头校验 | | ✅ | |
| response_time 校验 | | ✅ | |
| schema JSON Schema校验 | | ✅ | |
| custom 自定义表达式 | | ✅ | |

### 5. 变量管理

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| 单层 JSONPath 提取 | ✅ | | `$.token` |
| 嵌套提取 | ✅ | | `$.data.user.id` |
| 数组元素提取 | | ✅ | `$.items[0].id` |
| 数组遍历提取 | | ✅ | `$.items[*].id` |
| 响应头提取 | | ✅ | |
| 正则提取 | | ✅ | |
| 内置变量 | | ✅ | 时间戳、UUID等 |
| 环境变量引用 | ✅ | | |

### 6. HTTP 客户端

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| GET/POST/PUT/DELETE | ✅ | | 基础方法 |
| JSON 请求体 | ✅ | | |
| Form 表单 | | ✅ | |
| 文件上传 | | ✅ | |
| 自定义 Headers | ✅ | | |
| Query/Path 参数 | ✅ | | |
| 超时配置 | ✅ | | |
| 重试机制 | | ✅ | |
| 代理支持 | | ✅ | |
| SSL 配置 | | ✅ | |
| Cookie 管理 | | ✅ | |

### 7. 测试运行器

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| 顺序执行 | ✅ | | |
| 依赖注入 | ✅ | | |
| 失败继续执行 | ✅ | | |
| 失败快速终止 | | ✅ | |
| 并发执行 | | ✅ | |
| 重试失败用例 | | ✅ | |
| 用例过滤 | | ✅ | 标签/名称 |
| 数据驱动 | | ✅ | 参数化 |
| 前置/后置钩子 | | ✅ | |

### 8. 报告模块

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| Allure 基础报告 | ✅ | | 通过/失败 |
| 请求/响应详情 | ✅ | | |
| 断言详情 | ✅ | | |
| 执行时间统计 | ✅ | | |
| 失败附件 | | ✅ | 截图/日志 |
| 历史趋势 | | ✅ | |
| 环境信息 | | ✅ | |
| 分类统计 | | ✅ | |
| 邮件报告 | | ✅ | |
| IM 通知 | | ✅ | 钉钉/Slack |

### 9. CLI 命令

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| `apiflow run` | ✅ | | 完整流程 |
| `apiflow generate` | | ✅ | 仅生成计划 |
| `apiflow execute` | | ✅ | 仅执行 |
| `apiflow report` | | ✅ | 仅报告 |
| `apiflow validate` | | ✅ | 校验文档 |
| `--env` 参数 | | ✅ | 环境切换 |
| `--filter` 参数 | | ✅ | 用例过滤 |

### 10. 配置管理

| 功能 | MVP | 后续 | 说明 |
|------|:---:|:----:|------|
| `.env` 环境变量 | ✅ | | 敏感信息 |
| 单配置文件 | ✅ | | config.yaml |
| 多环境切换 | | ✅ | dev/test/prod |
| 配置校验 | | ✅ | pydantic |

---

## MVP 验收标准

1. 能解析一个 Swagger 3.0 文件
2. AI 能为每个接口生成 1 正向 + 1 异常用例
3. 能按依赖顺序执行测试用例
4. 能输出 Allure 测试报告
5. 单命令 `apiflow run` 跑通全流程

---

## 后续扩展场景

| 场景 | 状态 | 说明 |
|------|------|------|
| API 测试自动化 | MVP | 当前聚焦 |
| API 监控巡检 | 规划 | 定时检查 + 告警 |
| 端到端流程测试 | 规划 | 业务流程编排 |

---

## 版本规划

| 版本 | 目标 | 核心功能 |
|------|------|----------|
| v0.1 | MVP | 核心流程跑通 |
| v0.2 | 完善断言 | 更多断言类型 |
| v0.3 | 多格式 | Postman + OpenAPI 2.0 |
| v0.4 | CLI 增强 | 命令分离 + 环境切换 |
| v0.5 | 监控巡检 | 定时任务 + 告警 |
| v1.0 | 生产就绪 | 稳定性 + 文档 |

---

*创建时间：2026-01-16*
